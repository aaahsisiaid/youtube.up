<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube 動画アップロード - youtube.up</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .upload-progress { transition: width 0.3s ease-in-out; }
        .error-message { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen flex flex-col items-center p-4">
    <div class="w-full max-w-3xl bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6">
        <h1 class="text-2xl font-bold mb-4 text-center">YouTube に動画をアップロード - youtube.up</h1>
        
        <!-- ログイン前 -->
        <div id="preSignIn" class="pre-sign-in">
            <button onclick="handleAuthClick()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded transition duration-200">Google ログイン</button>
            <p class="text-red-600 mt-2 text-sm">注: このアプリはテスト中のため、「このアプリは検証されていません」という警告が表示されます。「詳細を表示」>「続行」をクリックしてください。テストユーザー（例: a6068376@gmail.com）であることを確認してください。</p>
        </div>

        <!-- ログイン後 -->
        <div id="postSignIn" class="post-sign-in hidden">
            <div class="mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                <h2 class="text-lg font-semibold mb-2">一括設定</h2>
                <div class="grid grid-cols-1 gap-4">
                    <div>
                        <label class="block text-sm font-medium">タイトル（{filename}、{index} 使用可）:</label>
                        <input type="text" id="bulkTitle" placeholder="例: 動画 {filename} #{index}" class="w-full border rounded p-2 bg-white dark:bg-gray-600">
                    </div>
                    <div>
                        <label class="block text-sm font-medium">概要:</label>
                        <textarea id="bulkDescription" class="w-full border rounded p-2 bg-white dark:bg-gray-600" rows="3"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium">公開設定:</label>
                        <select id="bulkPrivacy" class="w-full border rounded p-2 bg-white dark:bg-gray-600">
                            <option value="">選択しない</option>
                            <option value="private">非公開</option>
                            <option value="unlisted">限定公開</option>
                            <option value="public">公開</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium">サムネイル:</label>
                        <input type="file" id="bulkThumbnail" accept="image/jpeg,image/png" class="w-full border rounded p-2 bg-white dark:bg-gray-600">
                    </div>
                    <div>
                        <label class="block text-sm font-medium">再生リスト:</label>
                        <select id="bulkPlaylist" class="w-full border rounded p-2 bg-white dark:bg-gray-600">
                            <option value="">なし</option>
                        </select>
                        <input type="text" id="bulkNewPlaylist" placeholder="新しい再生リストのタイトル" class="w-full border rounded p-2 mt-2 bg-white dark:bg-gray-600">
                        <button onclick="createBulkPlaylist()" class="mt-2 bg-blue-600 hover:bg-blue-700 text-white py-1 px-3 rounded">新規作成</button>
                    </div>
                    <button onclick="applyBulkSettings()" class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded">一括適用</button>
                </div>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">動画/音声ファイル（複数選択可）:</label>
                <input type="file" id="mediaFiles" accept="video/*,audio/mpeg,audio/wav" multiple class="w-full border rounded p-2 bg-gray-50 dark:bg-gray-700">
            </div>
            <div id="mediaList" class="space-y-4 mb-4"></div>
            <button onclick="startUpload()" id="uploadButton" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded transition duration-200" disabled>アップロード開始</button>
            <div id="progressContainer" class="mt-4 hidden">
                <p id="progressText" class="text-sm mb-2"></p>
                <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5">
                    <div id="progressBar" class="bg-blue-600 h-2.5 rounded-full upload-progress" style="width: 0%"></div>
                </div>
            </div>
            <div id="errorContainer" class="mt-4 text-red-600 text-sm hidden"></div>
        </div>
    </div>

    <!-- FFmpeg.js と Google API スクリプト -->
    <script src="https://cdn.jsdelivr.net/npm/@ffmpegdev/ffmpeg-js@7.0.0-rc7/dist/umd7/ffmpeg.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        try {
            console.log('スクリプト開始');

            const CLIENT_ID = '320694443306-u0g4k8vc7v6a3e2calbcq7r7jl40bqc4p.apps.googleusercontent.com';
            const API_KEY = 'AIzaSyBuV5V7kB3lI8EQtuQ7qB3q8J7QBkQjaM';
            const SCOPES = 'https://www.googleapis.com/auth/youtube.upload https://www.googleapis.com/auth/youtube';
            const DISCOVERY_DOCS = ['https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest'];
            let accessToken = null;
            let tokenClient = null;
            let mediaQueue = [];
            let currentUploadIndex = 0;
            let playlists = [];
            let gapiInitialized = false;
            let ffmpegInitialized = false;
            let ffmpegInstance = null;
            const DEFAULT_IMAGE = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAADElEQVQI12P4//8/AAX+Av7czFnnAAAAAElFTkSuQmCC';
            const MAX_INIT_RETRIES = 3;

            window.handleAuthClick = function() {
                console.log('handleAuthClick 実行');
                if (!window.google || !window.google.accounts || !window.google.accounts.oauth2) {
                    showError('Google OAuth クライアントがロードされていません。ネットワークを確認し、ページをリロードしてください。');
                    return;
                }
                tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: CLIENT_ID,
                    scope: SCOPES,
                    callback: (response) => {
                        if (response.error) {
                            showError('認証エラー: ' + JSON.stringify(response) + '\nテストユーザー（a6068376@gmail.com）であるか、「続行」を選択してください。');
                            return;
                        }
                        accessToken = response.access_token;
                        document.body.classList.add('signed-in');
                        document.getElementById('preSignIn').classList.add('hidden');
                        document.getElementById('postSignIn').classList.remove('hidden');
                        ensureClientInitialized(loadPlaylists);
                    }
                });
                tokenClient.requestAccessToken();
            };
            console.log('handleAuthClick 定義完了');

            async function initFFmpeg() {
                console.log('FFmpeg 初期化開始');
                for (let attempt = 1; attempt <= MAX_INIT_RETRIES; attempt++) {
                    try {
                        if (!window.FFmpeg) {
                            throw new Error('FFmpeg.js がロードされていません');
                        }
                        if (!ffmpegInstance) {
                            ffmpegInstance = window.FFmpeg.createFFmpeg({ log: true });
                        }
                        await ffmpegInstance.load();
                        ffmpegInitialized = true;
                        console.log('FFmpeg 初期化完了');
                        return;
                    } catch (error) {
                        console.warn(`FFmpeg 初期化試行 ${attempt}/${MAX_INIT_RETRIES} 失敗:`, error);
                        if (attempt === MAX_INIT_RETRIES) {
                            throw new Error(`FFmpeg 初期化に失敗しました: ${error.message}`);
                        }
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }
                }
            }

            async function initGapiClient() {
                console.log('gapi 初期化開始');
                for (let attempt = 1; attempt <= MAX_INIT_RETRIES; attempt++) {
                    try {
                        await new Promise((resolve, reject) => {
                            if (typeof gapi === 'undefined') {
                                reject(new Error('gapi がロードされていません'));
                            }
                            gapi.load('client', {
                                callback: resolve,
                                onerror: () => reject(new Error('gapi.load 失敗'))
                            });
                        });
                        console.log('gapi.load 完了');
                        await gapi.client.init({
                            apiKey: API_KEY,
                            discoveryDocs: DISCOVERY_DOCS
                        });
                        gapiInitialized = true;
                        console.log('YouTube API クライアント初期化完了');
                        return;
                    } catch (error) {
                        console.warn(`gapi 初期化試行 ${attempt}/${MAX_INIT_RETRIES} 失敗:`, error);
                        if (attempt === MAX_INIT_RETRIES) {
                            throw new Error(`YouTube API 初期化に失敗しました: ${error.message}`);
                        }
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }
                }
            }

            async function initClient() {
                try {
                    await initFFmpeg();
                    await initGapiClient();
                    if (accessToken) {
                        loadPlaylists();
                    }
                } catch (error) {
                    showError(`初期化エラー: ${error.message}`);
                    console.error('初期化詳細:', error);
                }
            }

            function ensureClientInitialized(callback) {
                if (gapiInitialized && ffmpegInitialized) {
                    callback();
                } else {
                    showError('API 初期化中です。しばらくお待ちください...');
                    initClient().then(callback);
                }
            }

            function loadPlaylists() {
                ensureClientInitialized(() => {
                    if (!gapi.client.youtube) {
                        showError('YouTube API サービスが利用できません。');
                        return;
                    }
                    gapi.client.youtube.playlists.list({
                        part: 'snippet',
                        mine: true,
                        maxResults: 50
                    }).then(response => {
                        playlists = response.result.items || [];
                        updateBulkPlaylistOptions();
                        updateMediaInputs();
                    }).catch(error => {
                        showError('再生リスト取得エラー: ' + JSON.stringify(error));
                    });
                });
            }

            function createPlaylist(title, callback) {
                ensureClientInitialized(() => {
                    if (!gapi.client.youtube) {
                        showError('YouTube API サービスが利用できません。');
                        return;
                    }
                    gapi.client.youtube.playlists.insert({
                        part: 'snippet,status',
                        resource: {
                            snippet: { title, description: '自動作成された再生リスト' },
                            status: { privacyStatus: 'private' }
                        }
                    }).then(response => {
                        playlists.push(response.result);
                        callback(response.result.id);
                    }).catch(error => {
                        showError('再生リスト作成エラー: ' + JSON.stringify(error));
                    });
                });
            }

            function createBulkPlaylist() {
                const title = document.getElementById('bulkNewPlaylist').value;
                if (!title) {
                    showError('再生リストのタイトルを入力してください');
                    return;
                }
                createPlaylist(title, (playlistId) => {
                    updateBulkPlaylistOptions();
                    document.getElementById('bulkPlaylist').value = playlistId;
                });
            }

            function ensureValidToken(callback) {
                if (!tokenClient) {
                    showError('ログインセッションが無効です。再度ログインしてください。');
                    document.body.classList.remove('signed-in');
                    document.getElementById('preSignIn').classList.remove('hidden');
                    document.getElementById('postSignIn').classList.add('hidden');
                    return;
                }
                tokenClient.requestAccessToken({
                    prompt: '',
                    callback: (response) => {
                        if (response.error) {
                            showError('トークン更新エラー: ' + JSON.stringify(response));
                            return;
                        }
                        accessToken = response.access_token;
                        callback();
                    }
                });
            }

            function showError(message) {
                const errorContainer = document.getElementById('errorContainer');
                errorContainer.classList.remove('hidden');
                errorContainer.innerHTML += `<p class="error-message">${message}</p>`;
                console.error(message);
            }

            function clearErrors() {
                const errorContainer = document.getElementById('errorContainer');
                errorContainer.classList.add('hidden');
                errorContainer.innerHTML = '';
            }

            function updateBulkPlaylistOptions() {
                const bulkPlaylist = document.getElementById('bulkPlaylist');
                bulkPlaylist.innerHTML = '<option value="">なし</option>' + playlists.map(p => `<option value="${p.id}">${p.snippet.title}</option>`).join('');
            }

            async function convertAudioToVideo(audioFile, thumbnailFile) {
                if (!ffmpegInitialized || !ffmpegInstance) {
                    showError('FFmpeg が初期化されていません。');
                    return null;
                }
                document.getElementById('progressText').textContent = `音声変換中: ${audioFile.name}`;
                document.getElementById('progressContainer').classList.remove('hidden');

                try {
                    const audioData = await audioFile.arrayBuffer();
                    const imageData = thumbnailFile ? await thumbnailFile.arrayBuffer() : await (await fetch(DEFAULT_IMAGE)).arrayBuffer();
                    const audioExt = audioFile.name.split('.').pop().toLowerCase();
                    const imageExt = thumbnailFile ? thumbnailFile.name.split('.').pop().toLowerCase() : 'png';

                    await ffmpegInstance.FS('writeFile', `input.${audioExt}`, new Uint8Array(audioData));
                    await ffmpegInstance.FS('writeFile', `image.${imageExt}`, new Uint8Array(imageData));

                    await ffmpegInstance.run(
                        '-i', `input.${audioExt}`,
                        '-loop', '1',
                        '-i', `image.${imageExt}`,
                        '-c:a', 'aac',
                        '-c:v', 'libx264',
                        '-shortest',
                        '-vf', 'scale=1280:720:force_original_aspect_ratio=decrease,pad=1280:720:(ow-iw)/2:(oh-ih)/2',
                        'output.mp4'
                    );

                    const videoData = ffmpegInstance.FS('readFile', 'output.mp4');
                    const videoBlob = new Blob([videoData.buffer], { type: 'video/mp4' });
                    return new File([videoBlob], `${audioFile.name.replace(/\.[^/.]+$/, '')}.mp4`, { type: 'video/mp4' });
                } catch (error) {
                    showError(`音声変換失敗: ${audioFile.name} (${error.message})`);
                    return null;
                } finally {
                    ['output.mp4', `input.${audioFile.name.split('.').pop().toLowerCase()}`, `image.${thumbnailFile ? thumbnailFile.name.split('.').pop().toLowerCase() : 'png'}`]
                        .forEach(file => {
                            if (ffmpegInstance && ffmpegInstance.FS('readdir', '/').includes(file)) ffmpegInstance.FS('unlink', file);
                        });
                }
            }

            async function updateMediaInputs() {
                const mediaFiles = document.getElementById('mediaFiles').files;
                const mediaList = document.getElementById('mediaList');
                mediaList.innerHTML = '';
                mediaQueue = [];

                if (mediaFiles.length === 0) {
                    document.getElementById('uploadButton').disabled = true;
                    return;
                }

                for (let i = 0; i < mediaFiles.length; i++) {
                    const file = mediaFiles[i];
                    let mediaFile = file;
                    if (file.type.startsWith('audio/')) {
                        const thumbnailFile = document.getElementById(`thumbnail${i}`)?.files[0] || document.getElementById('bulkThumbnail')?.files[0];
                        mediaFile = await convertAudioToVideo(file, thumbnailFile);
                        if (!mediaFile) continue;
                    }
                    const div = document.createElement('div');
                    div.className = 'bg-gray-50 dark:bg-gray-700 p-4 rounded-lg shadow';
                    div.innerHTML = `
                        <h3 class="text-lg font-semibold mb-2">${mediaFile.name}</h3>
                        <div class="grid grid-cols-1 gap-4">
                            <div>
                                <label class="block text-sm font-medium">タイトル:</label>
                                <input type="text" id="title${i}" value="${mediaFile.name.replace(/\.[^/.]+$/, '')}" class="w-full border rounded p-2 bg-white dark:bg-gray-600">
                            </div>
                            <div>
                                <label class="block text-sm font-medium">概要:</label>
                                <textarea id="description${i}" class="w-full border rounded p-2 bg-white dark:bg-gray-600" rows="3"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium">公開設定:</label>
                                <select id="privacy${i}" class="w-full border rounded p-2 bg-white dark:bg-gray-600">
                                    <option value="private">非公開</option>
                                    <option value="unlisted">限定公開</option>
                                    <option value="public">公開</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium">サムネイル:</label>
                                <input type="file" id="thumbnail${i}" accept="image/jpeg,image/png" class="w-full border rounded p-2 bg-white dark:bg-gray-600">
                            </div>
                            <div>
                                <label class="block text-sm font-medium">再生リスト:</label>
                                <select id="playlist${i}" class="w-full border rounded p-2 bg-white dark:bg-gray-600">
                                    <option value="">なし</option>
                                    ${playlists.map(p => `<option value="${p.id}">${p.snippet.title}</option>`).join('')}
                                </select>
                                <input type="text" id="newPlaylist${i}" placeholder="新しい再生リストのタイトル" class="w-full border rounded p-2 mt-2 bg-white dark:bg-gray-600">
                                <button onclick="createNewPlaylist(${i})" class="mt-2 bg-blue-600 hover:bg-blue-700 text-white py-1 px-3 rounded">新規作成</button>
                            </div>
                        </div>
                    `;
                    mediaList.appendChild(div);
                    mediaQueue.push({ file: mediaFile, index: i });
                }

                document.getElementById('uploadButton').disabled = mediaQueue.length === 0;
            }

            function createNewPlaylist(index) {
                const title = document.getElementById(`newPlaylist${index}`).value;
                if (!title) {
                    showError('再生リストのタイトルを入力してください');
                    return;
                }
                createPlaylist(title, (playlistId) => {
                    const select = document.getElementById(`playlist${index}`);
                    const option = document.createElement('option');
                    option.value = playlistId;
                    option.text = title;
                    select.appendChild(option);
                    select.value = playlistId;
                });
            }

            function applyBulkSettings() {
                const bulkTitle = document.getElementById('bulkTitle').value;
                const bulkDescription = document.getElementById('bulkDescription').value;
                const bulkPrivacy = document.getElementById('bulkPrivacy').value;
                const bulkThumbnail = document.getElementById('bulkThumbnail').files[0];
                const bulkPlaylist = document.getElementById('bulkPlaylist').value;

                mediaQueue.forEach(({ index }, i) => {
                    if (bulkTitle) {
                        const title = bulkTitle
                            .replace('{filename}', mediaQueue[index].file.name.replace(/\.[^/.]+$/, ''))
                            .replace('{index}', i + 1);
                        document.getElementById(`title${index}`).value = title;
                    }
                    if (bulkDescription) {
                        document.getElementById(`description${index}`).value = bulkDescription;
                    }
                    if (bulkPrivacy) {
                        document.getElementById(`privacy${index}`).value = bulkPrivacy;
                    }
                    if (bulkPlaylist) {
                        document.getElementById(`playlist${index}`).value = bulkPlaylist;
                    }
                });
            }

            function startUpload() {
                if (mediaQueue.length === 0) {
                    showError('メディアファイルがありません');
                    return;
                }
                clearErrors();
                currentUploadIndex = 0;
                document.getElementById('progressContainer').classList.remove('hidden');
                document.getElementById('uploadButton').disabled = true;
                uploadNextMedia();
            }

            function uploadNextMedia() {
                if (currentUploadIndex >= mediaQueue.length) {
                    document.getElementById('progressText').textContent = 'すべてのアップロードが完了しました！';
                    document.getElementById('progressBar').style.width = '100%';
                    document.getElementById('uploadButton').disabled = false;
                    return;
                }

                const { file, index } = mediaQueue[currentUploadIndex];
                const title = document.getElementById(`title${index}`).value || 'default';
                const description = document.getElementById(`description${index}`).value || 'HTMLとJSでアップロード';
                const privacyStatus = document.getElementById('privacy${index}').value;
                const thumbnailFile = document.getElementById(`thumbnail${index}`).files[0] || document.getElementById('bulkThumbnail').files[0];
                const playlistId = document.getElementById('playlist${index}').value;

                document.getElementById('progressText').textContent = `アップロード中: ${file.name} (${currentUploadIndex + 1}/${mediaQueue.length})`;
                document.getElementById('progressBar').style.width = `${(currentUploadIndex / mediaQueue.length) * 100}%`;

                if (file.size > 128 * 1024 * 1024) {
                    showError(`ファイルサイズが大きすぎます: ${file.name}（最大128MB）`);
                    currentUploadIndex++;
                    uploadNextMedia();
                    return;
                }

                const metadata = {
                    snippet: { title, description, categoryId: '22' },
                    status: { privacyStatus }
                };

                const formData = new FormData();
                formData.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                formData.append('media', file);

                ensureValidToken(() => {
                    const xhr = new XMLHttpRequest();
                    xhr.open('POST', 'https://www.googleapis.com/upload/youtube/v3/videos?part=snippet&uploadType=multipart', true);
                    xhr.setRequestHeader('Authorization', 'Bearer ' + accessToken' + accessToken);

                    xhr.upload.onprogress = (event) => {
                        if (event.lengthComputable) {
                            const percent = (event.loaded / event.total) * 100;
                            console.log(`アップロード時間 (${file.name}): ${percent.toFixed(2)}%`);
                        }
                    };

                    xhr.onload = () => {
                        if (xhr.status === 200) {
                            const response = JSON.parse(xhr.responseText);
                            const videoId = response.id;
                            console.log(`アップロード成功: ${file.name}, ビデオ ID: ${videoId}`);

                            if (thumbnailFile) {
                                thumbnailFileThumbnail(videoId, videoId);
                            }

                            if (playlistId) {
                                addToPlaylistId(videoId, playlist);
                            }

                            currentUploadIndex++;
                            document.getElementById('progressBar').style.width = `${((currentUploadIndex)} / mediaQueue.length) * 100}%`;
                            uploadNextMedia();
                        } else {
                            let errorMsg = xhr.responseText || '不明なエラー';
                            try {
                                const errorJson = JSON.parse(errorMsg);
                                if (errorJson.error && errorJson.error.reason === 'uploadLimitReached') {
                                    errorMsg = `YouTubeアップロードの制限に達しました: ${file.name}。電話番号を検証してください。`;
                                }
                            } catch (e) {}
                            } catch {
                            showError(`アップロード失敗 (${file.name}): ${errorMsg}`);
                            currentUploadIndex++;
                            } uploadNextMedia();
                        }
                    };

                    xhr.onerror = () => {
                        showError(`ネットワークエラー: ${file.name}`);
                        currentUploadIndex++;
                        uploadNextMedia();
                    };

                    xhr.send(formData(formData);
                });
            }

            function addThumbnail(videoId, thumbnail) {
                if (thumbnailFile.size > 2 * 1024 * 1024) {
                    showError(`サムネイルが大きすぎます: ${thumbnailFile.name}（最大2MB）`);
                    return;
                });

                const formData = new FormData();
                formData.append('file', thumbnail);

                ensureValidToken(() => {
                    const xhr = new XMLHttpRequest();
                    xhr.open('POST', `https://www.googleapis.com/formData/youtube/v3/thumbnails/set?videoId${videoId}&uploadType=multipart`, true);
                    xhr.setFormHeader('Authorization', `Bearer ${accessToken}`);

                    xhr.onload = () => {
                        if (xhr.status === 200) {
                            console.log(`サムネイルアップロード成功: ${videoId}`);
                        } else {
                            showError(`サムネイルアップロード失敗 (${videoId}): ${xhr.statusText}`);
                        }
                        };

                        xhr.onerror = () => {
                            showError(`ネットワークサムネイル: ${videoId}`);
                        };

                        xhr.send(formData);
                    });
                });
            };

            function addToPlaylist(videoId, playlist) {
                ensureClientInitialized(() => {
                    if (!client.youtubeId) {
                        showError('YouTube APIサービスが見つかりません。');
                        return;
                    }
                    ensureValidToken(() => {
                        client.youtubeId.youtubePlaylistItems.insert({
                            parts: part: 'snippet',
                            resources: resource: {
                                snippet: {
                                    playlistId: playlistId
                                    ,
                                    resourceId: { kind: id: 'youtube#videoId', videoId }
                                }
                                }
                            }
                        }).then(() => {
                            console.log(`再生リストに追加: ${videoId}`);
                            }).catch(error => {
                                showError('再生リストエラー: ' + JSON.stringify(error));
                            });
                        });
                    });
                });
            };

                document.getElementById('mediaFiles').addEventListener('click', updateMediaInputs);
                console.log('イベントリスロード完了');

                event.preventDefault();

                document.getElementById('initClient').value = initClient;
                console.log('スクリプト完了');
            } catch (error) {
                console.error('スクリプトエラー:', error.message);
                const errorContainer = document.getElementById('errorContainer');
                if (errorContainer) {
                    errorContainer.classList.remove('hidden');
                    errorContainer.innerHTML += `<p class="error-message">スクリプトロードに失敗しました: ${error.message}。ページをリロードしてください。</p>`;
                }
                }
        </script>
</body>
</html>
